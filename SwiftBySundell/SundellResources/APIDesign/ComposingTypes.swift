//
//  ComposingTypes.swift
//  SwiftBySundell
//
//  Created by Vladislav Gushin on 11/03/2019.
//  Copyright ¬© 2019 Vladislav Gushin. All rights reserved.
//

import UIKit
/*–ö–æ–º–ø–æ–∑–∏—Ü–∏—è - —ç—Ç–æ –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω—ã–π –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º —Ä–∞–∑–¥–µ–ª—è—Ç—å –∫–æ–¥ –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ç–∏–ø–∞–º–∏ –≤ –±–æ–ª–µ–µ –Ω–µ—Å–≤—è–∑–Ω–æ–π —Ñ–æ—Ä–º–µ. –≠—Ç–æ —á–∞—Å—Ç–æ –ø—Ä–µ–ø–æ–¥–Ω–æ—Å–∏—Ç—Å—è –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –ø–æ–¥–∫–ª–∞—Å—Å–∞–º, —Å —Ç–∞–∫–∏–º–∏ —Ñ—Ä–∞–∑–∞–º–∏, –∫–∞–∫ ¬´–ö–æ–º–ø–æ–∑–∏—Ü–∏—è –Ω–∞–¥ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º¬ª - –∏–¥–µ—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —á–∞—Å—Ç–µ–π –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ –¥–µ—Ä–µ–≤–æ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.
 
 –•–æ—Ç—è —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª–∞—Å—Å–æ–≤ / –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–∞–∫–∂–µ —è–≤–ª—è–µ—Ç—Å—è —á—Ä–µ–∑–≤—ã—á–∞–π–Ω–æ –ø–æ–ª–µ–∑–Ω—ã–º (–∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ Apple, –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö –º—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º, –≤ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —ç—Ç–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞), —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –º–Ω–æ–≥–æ —Å–∏—Ç—É–∞—Ü–∏–π, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –º–æ–∂–µ—Ç –ø–æ–∑–≤–æ–ª–∏—Ç—å –≤–∞–º –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–π –∏ –Ω–∞–¥–µ–∂–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥.
 
 –ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ –¥–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏–π –∏ —Ç–æ, –∫–∞–∫ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–∑–∏—Ü–∏—é —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏, –∫–ª–∞—Å—Å–∞–º–∏ –∏ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è–º–∏ –≤ Swift.*/

// MARK: - Struct composition

/*–î–æ–ø—É—Å—Ç–∏–º, –º—ã –ø–∏—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π, –≤ –∫–æ—Ç–æ—Ä–æ–º –µ—Å—Ç—å –º–æ–¥–µ–ª—å User –∏ –º–æ–¥–µ–ª—å Friend. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –∞ –º–æ–¥–µ–ª—å –¥—Ä—É–∑–µ–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ, –Ω–æ —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é - –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –¥–∞—Ç—É, –∫–æ–≥–¥–∞ –¥–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—Ç–∞–ª–∏ –¥—Ä—É–∑—å—è–º–∏.
 
 –ü—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏—è –æ —Ç–æ–º, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —ç—Ç–∏ –º–æ–¥–µ–ª–∏, –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∏–¥–µ–µ–π (–æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –≤—ã –ø—Ä–∏—à–ª–∏ –∏–∑ —è–∑—ã–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ –æ–ø–∏—Ä–∞–ª–∏—Å—å –Ω–∞ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, —Ç–∞–∫–∏—Ö –∫–∞–∫ Objective-C) –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–¥–µ–ª–∞—Ç—å Friend –ø–æ–¥–∫–ª–∞—Å—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫–∞–∫ —ç—Ç–æ:
*/

fileprivate class User {
    var name: String
    var age: Int

    init(name: String, age: Int) {
        self.name = name
        self.age = age
    }
}

fileprivate class Friend: User {
    var friendshipDate: Date
    init(name: String, age: Int, friendshipDate: Date) {
        self.friendshipDate = friendshipDate
        super.init(name: name, age: age)
    }
}

/*–•–æ—Ç—è –≤—ã—à–µ—Å–∫–∞–∑–∞–Ω–Ω–æ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —É –Ω–µ–≥–æ –µ—Å—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏. –¢—Ä–∏ –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏:
 
 1)–ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, –º—ã –≤—ã–Ω—É–∂–¥–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —è–≤–ª—è—é—Ç—Å—è —Å—Å—ã–ª–æ—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏. –î–ª—è –º–æ–¥–µ–ª–µ–π —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º—ã –º–æ–∂–µ–º –ª–µ–≥–∫–æ –≤–≤–µ—Å—Ç–∏ –æ–±—â–µ–µ –∏–∑–º–µ–Ω—è–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ. –ï—Å–ª–∏ –æ–¥–Ω–∞ —á–∞—Å—Ç—å –Ω–∞—à–µ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –∏–∑–º–µ–Ω—è–µ—Ç –º–æ–¥–µ–ª—å, –æ–Ω–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Ä–∞–∂–∞—Ç—å—Å—è –≤–µ–∑–¥–µ, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–∞–º, –µ—Å–ª–∏ —Ç–∞–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –±—É–¥—É—Ç —Å–æ–±–ª—é–¥–µ–Ω—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ.
 2)–ü–æ—Å–∫–æ–ª—å–∫—É –î—Ä—É–≥ —Ç–∞–∫–∂–µ —è–≤–ª—è–µ—Ç—Å—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –î—Ä—É–≥ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–¥–∞–Ω –≤ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –≠—Ç–æ –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –±–µ–∑–≤—Ä–µ–¥–Ω—ã–º, –Ω–æ —ç—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∏—Å–∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞—à–µ–≥–æ –∫–æ–¥–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä Friend –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —Ç–∞–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –∫–∞–∫ saveDataForCurrentUser.
 3)–î–ª—è –¥—Ä—É–≥–∞ –º—ã –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –Ω–µ —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã —Å–≤–æ–π—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—ã–ª–∏ –∏–∑–º–µ–Ω—è–µ–º—ã–º–∏ (–¥–æ–≤–æ–ª—å–Ω–æ —Å–ª–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è –¥—Ä—É–≥–∞ üòÖ), –Ω–æ, –ø–æ—Å–∫–æ–ª—å–∫—É –º—ã –ø–æ–ª–∞–≥–∞–µ–º—Å—è –Ω–∞ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, –º—ã —Ç–∞–∫–∂–µ –Ω–∞—Å–ª–µ–¥—É–µ–º –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç—å –≤—Å–µ—Ö —Å–≤–æ–π—Å—Ç–≤.
 –î–∞–≤–∞–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–∑–∏—Ü–∏—é –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ! –î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã User –∏ Friend (—á—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –Ω–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –≤ Swift —Ñ—É–Ω–∫—Ü–∏–π –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏), –∏ –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã Friend –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Ä–∞—Å—à–∏—Ä—è–ª User, –¥–∞–≤–∞–π—Ç–µ —Å–æ—Å—Ç–∞–≤–∏–º —ç–∫–∑–µ–º–ø–ª—è—Ä User –≤–º–µ—Å—Ç–µ —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –æ—Ç–Ω–æ—Å—è—â–∏–º–∏—Å—è –∫ –¥—Ä—É–≥—É, –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∏–ø–∞ Friend, –Ω–∞–ø—Ä–∏–º–µ—Ä:
*/

fileprivate struct User1 {
    var name: String
    var age: Int
}

fileprivate struct Friend1 {
    let user: User1
    var friendshipDate: Date
}

// MARK: - Class composition

/*–ó–Ω–∞—á–∏—Ç –ª–∏ —ç—Ç–æ, —á—Ç–æ –º—ã –¥–æ–ª–∂–Ω—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤—Å–µ –Ω–∞—à–∏ —Ç–∏–ø—ã —Å—Ç—Ä—É–∫—Ç—É—Ä? –Ø –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ —Ç–∞–∫ –Ω–µ –¥—É–º–∞—é. –ö–ª–∞—Å—Å—ã –æ—á–µ–Ω—å –º–æ—â–Ω—ã–µ, –∏ –∏–Ω–æ–≥–¥–∞ –≤—ã —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –≤–∞—à–∏ —Ç–∏–ø—ã –∏–º–µ–ª–∏ —Å–µ–º–∞–Ω—Ç–∏–∫—É —Å—Å—ã–ª–æ–∫, –∞ –Ω–µ —Å–µ–º–∞–Ω—Ç–∏–∫—É –∑–Ω–∞—á–µ–Ω–∏–π. –ù–æ –¥–∞–∂–µ –µ—Å–ª–∏ –º—ã —Ä–µ—à–∏–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å—ã, –º—ã –≤—Å–µ —Ä–∞–≤–Ω–æ –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–∑–∏—Ü–∏—é –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—é –≤–æ –º–Ω–æ–≥–∏—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö.
 
 –î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞—à–∏—Ö –º–æ–¥–µ–ª–µ–π Friend –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞. –ú—ã —Å–æ–∑–¥–∞–¥–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è - –Ω–∞–∑–æ–≤–µ–º –µ–≥–æ FriendListViewController - –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç UITableView –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞—à–∏—Ö –¥—Ä—É–∑–µ–π.
 
 –û–¥–∏–Ω –∏–∑ –Ω–∞–∏–±–æ–ª–µ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∞–±–ª–∏—á–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ–±—ã —Å–∞–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –±—ã–ª –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–≤–æ–µ–≥–æ —Ç–∞–±–ª–∏—á–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (—ç—Ç–æ –¥–∞–∂–µ —Ç–æ, –∫ —á–µ–º—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è UITableViewController)
 –Ø –Ω–µ —Å–æ–±–∏—Ä–∞—é—Å—å –≥–æ–≤–æ—Ä–∏—Ç—å, —á—Ç–æ –¥–µ–ª–∞—Ç—å –≤—ã—à–µ–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –ø–ª–æ—Ö–æ, –∏ –≤—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–ª–∂–Ω—ã —ç—Ç–æ–≥–æ –¥–µ–ª–∞—Ç—å, –Ω–æ –µ—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º —Å–¥–µ–ª–∞—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –±–æ–ª–µ–µ —Ä–∞–∑–æ–±—â–µ–Ω–Ω–æ–π –∏ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π - –¥–∞–≤–∞–π—Ç–µ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–∑–∏—Ü–∏—é.
 
 –ú—ã –Ω–∞—á–Ω–µ–º —Å —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç UITableViewDataSource, –∫–æ—Ç–æ—Ä–æ–º—É –º—ã –º–æ–∂–µ–º –ø—Ä–æ—Å—Ç–æ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –Ω–∞—à —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π, –∏ –æ–Ω –±—É–¥–µ—Ç —Å–Ω–∞–±–∂–∞—Ç—å —Ç–∞–±–ª–∏—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:*/


fileprivate class FriendListTableViewDataSource: NSObject, UITableViewDataSource {
    var friends = [Friend1]()

    func tableView(_ tableView: UITableView,
                   numberOfRowsInSection section: Int) -> Int {
        return friends.count
    }

    func tableView(_ tableView: UITableView,
                   cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        return UITableViewCell(frame: .zero)
    }
}

fileprivate class FriendListViewController: UIViewController {
    private weak var tableView: UITableView!
    private let dataSource = FriendListTableViewDataSource()

    override func viewDidLoad() {
        super.viewDidLoad()
        self.tableView.dataSource = self.dataSource
    }

    func render(_ friends: [Friend1]) {
        dataSource.friends = friends
        tableView.reloadData()
    }
}

/*–ü—Ä–µ–ª–µ—Å—Ç—å —ç—Ç–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –≤ —Ç–æ–º, —á—Ç–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—á–µ–Ω—å –ª–µ–≥–∫–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é, –µ—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π –≥–¥–µ-—Ç–æ –µ—â–µ –≤ –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ ¬´–ù–∞–π–¥–∏ –¥—Ä—É–≥–∞¬ª). –í –æ–±—â–µ–º, —É–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Ö–æ—Ä–æ—à–∏–º —Å–ø–æ—Å–æ–±–æ–º –∏–∑–±–µ–∂–∞—Ç—å —Å–∏–Ω–¥—Ä–æ–º–∞ ¬´Massive view controller¬ª, –∏ —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ, –∫–∞–∫ –º—ã —Å–¥–µ–ª–∞–ª–∏ –Ω–∞—à –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –æ—Ç–¥–µ–ª—å–Ω—ã–º, —Å–æ—Å—Ç–∞–≤–Ω—ã–º —Ç–∏–ø–æ–º - –º—ã –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å —Ç–æ –∂–µ —Å–∞–º–æ–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π ( –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç. –¥.).
 
 –î—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ —Å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, —Å–æ—Å—Ç–æ–∏—Ç –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–ª–∞–≥–∏–Ω–æ–≤ –≤ Swift" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —ç—Ç–æ–º.*/

// MARK: - Enum composition
/*–ù–∞–∫–æ–Ω–µ—Ü, –¥–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–π –º–æ–∂–µ—Ç –¥–∞—Ç—å –Ω–∞–º –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –º–µ–Ω—å—à–µ–º—É –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é –∫–æ–¥–∞. –î–æ–ø—É—Å—Ç–∏–º, –º—ã —Å–æ–∑–¥–∞–µ–º —Ç–∏–ø Operation, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç—è–∂–µ–ª—É—é —Ä–∞–±–æ—Ç—É –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ. –ß—Ç–æ–±—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏, –º—ã —Å–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ State, –≤ –∫–æ—Ç–æ—Ä–æ–º –µ—Å—Ç—å —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –Ω–µ—É–¥–∞—á–µ–π –∏–ª–∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è:*/
fileprivate class Operation {
    enum State {
        case loading
        case failed(Error)
        case finished
    }

    private var state = State.loading
    private var action: ()throws -> Void

    init(_ actions: @escaping ()throws -> Void) {
        self.action = actions
    }

    func startWithStateHandler(then handler: (State) -> Void) {
        do {
            try self.action()
            self.state = .finished
            handler(self.state)
        } catch {
            self.state = .failed(error)
            handler(self.state)
        }
    }
}

fileprivate class ImageProcessor {
    func process(image: UIImage)throws {

    }
}

fileprivate class ImageProcessingViewController: UIViewController {
    func processImages(_ images: [UIImage]) {
        let operation = Operation {
            let processor = ImageProcessor()
            try images.forEach(processor.process)
        }

        operation.startWithStateHandler { [weak self] state in
            switch state {
            case .loading:
                self?.showActivityIndicatorIfNeeded()
            case .failed(let error):
                self?.cleanupCache()
                self?.removeActivityIndicator()
                self?.showErrorView(for: error)
            case .finished:
                self?.cleanupCache()
                self?.removeActivityIndicator()
                self?.showFinishedView()
            }
        }
    }

    func cleanupCache() { }
    func removeActivityIndicator() { }
    func showFinishedView() { }
    func showErrorView(for: Error) { }
    func showActivityIndicatorIfNeeded() { }
}

/*–ù–∞ –ø–µ—Ä–≤—ã–π –≤–∑–≥–ª—è–¥ –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å—Å—è, —á—Ç–æ —Å –≤—ã—à–µ–ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–º –∫–æ–¥–æ–º –Ω–µ –≤—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ, –Ω–æ –µ—Å–ª–∏ –º—ã –ø–æ–±–ª–∏–∂–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –º—ã —Å–ø—Ä–∞–≤–ª—è–µ–º—Å—è —Å –Ω–µ—É–¥–∞—á–Ω—ã–º–∏ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–º–∏ —Å–ª—É—á–∞—è–º–∏, –º—ã –º–æ–∂–µ–º —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ –∑–¥–µ—Å—å –µ—Å—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞.
 
 –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –Ω–µ –≤—Å–µ–≥–¥–∞ –ø–ª–æ—Ö–æ, –Ω–æ –∫–æ–≥–¥–∞ –¥–µ–ª–æ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π, –ø–æ–¥–æ–±–Ω—ã—Ö —ç—Ç–æ–π, –æ–±—ã—á–Ω–æ —Ö–æ—Ä–æ—à–µ–π –∏–¥–µ–µ–π —è–≤–ª—è–µ—Ç—Å—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∫ –º–æ–∂–Ω–æ –º–µ–Ω—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –Ω–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –ø–∏—Å–∞—Ç—å –±–æ–ª—å—à–µ —Ç–µ—Å—Ç–æ–≤ –∏ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –±–æ–ª—å—à–µ —Ä—É—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞, —á—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ –∫–æ–¥—É - –∏ —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ—à–∏–±–æ–∫ –ª–µ–≥—á–µ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ —Ç—Ä–µ—â–∏–Ω—ã, –∫–æ–≥–¥–∞ –º—ã –º–µ–Ω—è–µ–º –≤–µ—â–∏.
 
 –≠—Ç–æ –µ—â–µ –æ–¥–Ω–∞ —Å–∏—Ç—É–∞—Ü–∏—è, –≤ –∫–æ—Ç–æ—Ä–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –æ—á–µ–Ω—å —É–¥–æ–±–Ω–∞. –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ, –¥–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º –¥–≤–∞ - –æ–¥–Ω–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—à–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∞ –¥—Ä—É–≥–æ–µ –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:*/

fileprivate class Operation1 {
    enum State {
        case loading
        case finished(Outcome)
    }

    enum Outcome {
        case failed(Error)
        case succeeded
    }

    private var state = State.loading
    private var action: ()throws -> Void

    init(_ actions: @escaping ()throws -> Void) {
        self.action = actions
    }

    func startWithStateHandler(then handler: (State) -> Void) {
        do {
            try self.action()
            self.state = .finished(.succeeded)
            handler(self.state)
        } catch {
            self.state = .finished(.failed(error))
            handler(self.state)
        }
    }
}

fileprivate class ImageProcessingViewController1: UIViewController {
    func processImages(_ images: [UIImage]) {
        let operation = Operation1 {
            let processor = ImageProcessor()
            try images.forEach(processor.process)
        }

        operation.startWithStateHandler { [weak self] state in
            switch state {
            case .loading:
                self?.showActivityIndicatorIfNeeded()
            case .finished(let outcome):
                self?.cleanupCache()
                self?.removeActivityIndicator()
                
                switch outcome {
                case .failed(let error):
                    self?.showErrorView(for: error)
                case .succeeded:
                    self?.showFinishedView()
                }
            }
        }
    }

    func cleanupCache() { }
    func removeActivityIndicator() { }
    func showFinishedView() { }
    func showErrorView(for: Error) { }
    func showActivityIndicatorIfNeeded() { }
}
