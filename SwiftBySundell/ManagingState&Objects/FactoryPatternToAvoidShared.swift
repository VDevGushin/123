//
//  FactoryPatternToAvoidShared.swift
//  SwiftBySundell
//
//  Created by Vladislav Gushin on 11/01/2019.
//  Copyright ¬© 2019 Vladislav Gushin. All rights reserved.
//

import UIKit

// MARK: - Help classes
fileprivate enum Result<T> {
    case error(Error)
    case value(T)
}

extension URL {
    static var todoList = URL(string: "!23")!
}
// MARK: -
/*
 –î–æ–ø—É—Å—Ç–∏–º, –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª–∞—Å—Å Request, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –Ω–∞—à–µ–º—É –±—ç–∫—ç–Ω–¥—É. –ï–≥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
 */

fileprivate class Request {
    enum State {
        case pending
        case ongoing
        case complete(Result<Data>)
    }

    let url: URL
    let parameters: [String: String]
    var state = State.pending

    init(url: URL, parameters: [String: String] = [:]) {
        self.url = url
        self.parameters = parameters
    }
}

fileprivate struct DataLoader {
    func perform(_ request: Request, then handler: (Result<Data>) -> Void) {

    }
}

/*
 –ò—Ç–∞–∫, –≤ —á–µ–º –ø—Ä–æ–±–ª–µ–º–∞ —Å –≤—ã—à–µ—É–∫–∞–∑–∞–Ω–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π? –ü–æ—Å–∫–æ–ª—å–∫—É –∑–∞–ø—Ä–æ—Å —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, –≥–¥–µ –∏ –∫–∞–∫ –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∑–∞–ø—Ä–æ—Å, –Ω–æ —Ç–∞–∫–∂–µ –∏ –µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –º—ã –º–æ–∂–µ–º –≤ –∫–æ–Ω–µ—á–Ω–æ–º –∏—Ç–æ–≥–µ –¥–æ–≤–æ–ª—å–Ω–æ –ª–µ–≥–∫–æ –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏.
 
 –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, –Ω–µ –∑–Ω–∞–∫–æ–º—ã–π —Å –¥–µ—Ç–∞–ª—è–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Request, –º–æ–∂–µ—Ç –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç—å, —á—Ç–æ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ–π —Ç–∏–ø –∑–Ω–∞—á–µ–Ω–∏—è (–æ–Ω –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫), –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä:
 */

fileprivate class TodoListViewController: UIViewController {
    private let request = Request(url: .todoList)
    private let dataLoader = DataLoader()

    func loadItems() {
        dataLoader.perform(request) { [weak self] in
            self?.render($0)
        }
    }

    private func render(_ result: Result<Data>) { }
}

/*
 –° –ø–æ–º–æ—â—å—é –æ–ø–∏—Å–∞–Ω–Ω–æ–π –≤—ã—à–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º—ã –º–æ–∂–µ–º –ª–µ–≥–∫–æ –æ–∫–∞–∑–∞—Ç—å—Å—è –≤ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö, –∫–æ–≥–¥–∞ loadItems –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑, –ø—Ä–µ–∂–¥–µ —á–µ–º –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º—ã –º–æ–∂–µ–º –≤–∫–ª—é—á–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∏—Å–∫–æ–º –∏–ª–∏ –º–µ—Ö–∞–Ω–∏–∑–º –≤—ã—Ç—è–≥–∏–≤–∞–Ω–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤). –¢–∞–∫ –∫–∞–∫ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞, –º—ã –±—É–¥–µ–º –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –Ω–∞—à DataLoader –æ—á–µ–Ω—å –∑–∞–ø—É—Ç–∞–Ω–Ω—ã–º üò¨.
 
 –û–¥–Ω–∏–º –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤ —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã —è–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ–Ω–∞ –∫–∞–∂–¥–æ–≥–æ –æ–∂–∏–¥–∞—é—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ. –•–æ—Ç—è —ç—Ç–æ –º–æ–∂–µ—Ç —Ä–µ—à–∏—Ç—å –Ω–∞—à—É –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É –∑–¥–µ—Å—å, —ç—Ç–æ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ –≤—ã–∑–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ, –∏ —Å–¥–µ–ª–∞—Ç—å API –Ω–∞–º–Ω–æ–≥–æ –±–æ–ª–µ–µ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º –∏ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–º –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏.
 */

/*
 –§–∞–±—Ä–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã
 –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ, –¥–∞–≤–∞–π—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è –¥—Ä—É–≥–∏–º –º–µ—Ç–æ–¥–æ–º –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –≤—ã—à–µ—É–∫–∞–∑–∞–Ω–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–∞–±—Ä–∏—á–Ω—ã–π –º–µ—Ç–æ–¥, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Å–≤—è–∑–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ —Å —Å–∞–º–∏–º –∏—Å—Ö–æ–¥–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º. –≠—Ç–æ—Ç –≤–∏–¥ —Ä–∞–∑–≤—è–∑–∫–∏ –æ–±—ã—á–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –æ–±—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —è–≤–ª—è–µ—Ç—Å—è —Ö–æ—Ä–æ—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–≥–æ –∫–æ–¥–∞ –≤ —Ü–µ–ª–æ–º.
 –ò—Ç–∞–∫, –∫–∞–∫ –±—ã –º—ã –ø—Ä–æ–≤–µ–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Request –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ–∞–±—Ä–∏—á–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞? –ú—ã –Ω–∞—á–Ω–µ–º —Å –≤–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–∞ StatefulRequest, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –ø–æ–¥–∫–ª–∞—Å—Å–æ–º Request, –∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –≤ –Ω–µ–≥–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä —Ç–∞–∫:
 */
// MARK: - Factory methods

fileprivate class RequestV2 {
    let url: URL
    let parameters: [String: String]

    init(url: URL, parameters: [String: String] = [:]) {
        self.url = url
        self.parameters = parameters
    }
}

fileprivate class StatefulRequest: RequestV2 {
    enum State {
        case pending
        case ongoing
        case completed(Result<Data>)
    }
    var state = State.pending
}

fileprivate extension RequestV2 {
    //Factory method
    func makeStateful() -> StatefulRequest {
        return StatefulRequest(url: url, parameters: parameters)
    }
}

/*–ù–∞–∫–æ–Ω–µ—Ü, –∫–æ–≥–¥–∞ DataLoader –Ω–∞—á–∏–Ω–∞–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å, –º—ã –ø—Ä–æ—Å—Ç–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ–º –µ–≥–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π StatefulRequest:*/

fileprivate class DataLoaderV2 {
    func perform(_ request: RequestV2) {
        let statefulRequest = request.makeStateful()
        perform(statefulRequest)
    }

    private func perform(_ request: StatefulRequest) {
        // Actually perform the request
    }
}


// MARK: - Factories

/*
 –î–∞–ª–µ–µ, –¥–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –¥—Ä—É–≥—É—é —Å–∏—Ç—É–∞—Ü–∏—é, –∫–æ–≥–¥–∞ —Ñ–∞–±—Ä–∏—á–Ω—ã–π —à–∞–±–ª–æ–Ω –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ–±—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–∞–±—Ä–∏—á–Ω—ã–µ —Ç–∏–ø—ã.
 
 –î–æ–ø—É—Å—Ç–∏–º, –º—ã —Å–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ —Ñ–∏–ª—å–º–∞—Ö, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ñ–∏–ª—å–º—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏–ª–∏ –ø–æ–ª—É—á–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏. –£ –Ω–∞—Å –±—É–¥–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–¥–Ω–æ—ç–ª–µ–º–µ–Ω—Ç–Ω—ã–π MovieLoader –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –Ω–∞—à–µ–º—É –±—ç–∫—ç–Ω–¥—É, –Ω–∞–ø—Ä–∏–º–µ—Ä —Ç–∞–∫:
 */

fileprivate class CategoryViewController: UIViewController {
    class MovieLoader {
        static let shared = MovieLoader()
        private init() { }
        func loadMovies(in: Int, sectionIndex: Int, then handler: (Result<Data>) -> Void) {

        }

        private func cancelAllRequests() { }

        deinit {
            self.cancelAllRequests()
        }
    }

    // We paginate our view using section indexes, so that we
    // don't have to load all data at once
    func loadMovies(atSectionIndex sectionIndex: Int) {
        MovieLoader.shared.loadMovies(in: 1, sectionIndex: sectionIndex) {
            [weak self] result in
            self?.render(result)
        }
    }

    private func render(_ result: Result<Data>) { }
}

/*
 –ü–æ–Ω–∞—á–∞–ª—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞ –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –ø—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω—ã–º (—ç—Ç–æ —Ç–∞–∫–∂–µ –æ—á–µ–Ω—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–æ), –Ω–æ –º—ã –º–æ–∂–µ–º –æ–∫–∞–∑–∞—Ç—å—Å—è –≤ –¥–æ–≤–æ–ª—å–Ω–æ —Å–ª–æ–∂–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–Ω–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã. –ú—ã –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–ª–∏–Ω–Ω—É—é –æ—á–µ—Ä–µ–¥—å –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, —á—Ç–æ –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω—ã–º –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –ø–ª–æ—Ö–∏—Ö —Å–µ—Ç–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö.
 
 –ó–¥–µ—Å—å –º—ã —Å—Ç–∞–ª–∫–∏–≤–∞–µ–º—Å—è —Å –¥—Ä—É–≥–æ–π –ø—Ä–æ–±–ª–µ–º–æ–π, –∫–æ—Ç–æ—Ä–∞—è —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–≥—Ä—É–∑–∫–∏).
 
 –ß—Ç–æ–±—ã —Ä–µ—à–∏—Ç—å —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É, –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä MovieLoader –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º—ã –º–æ–∂–µ–º –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π –∑–∞–≥—Ä—É–∑—á–∏–∫ –æ—Ç–º–µ–Ω—è–ª –≤—Å–µ –æ–∂–∏–¥–∞—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã, –∫–æ–≥–¥–∞ –æ–Ω –±—ã–ª –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω, —á—Ç–æ–±—ã –æ—á–µ—Ä–µ–¥—å –Ω–µ –±—ã–ª–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞–º–∏, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –º—ã –±–æ–ª—å—à–µ –Ω–µ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω—ã:
 */

/* –û–¥–Ω–∞–∫–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –Ω–∞–º –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä MovieLoader –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –º—ã —Å–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è. –í–µ—Ä–æ—è—Ç–Ω–æ, –Ω–∞–º –Ω—É–∂–Ω–æ –≤–Ω–µ–¥—Ä–∏—Ç—å —Ç–∞–∫–∏–µ –≤–µ—â–∏, –∫–∞–∫ –∫—ç—à, —Å–µ–∞–Ω—Å URL –∏ –¥—Ä—É–≥–∏–µ –≤–µ—â–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è. –≠—Ç–æ –∑–≤—É—á–∏—Ç –≥—Ä—è–∑–Ω–æ, –¥–∞–≤–∞–π—Ç–µ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–±—Ä–∏–∫—É!*/

fileprivate class MoveLoaderV2 {
    let session: URLSession
    init(session: URLSession) {
        self.session = session
    }

    private func cancelAllRequests() {
        self.session.invalidateAndCancel()
    }

    deinit {
        self.cancelAllRequests()
    }
}

fileprivate struct MovieLoaderFactory {
    private let session: URLSession

    func makeLoader() -> MoveLoaderV2 {
        return MoveLoaderV2(session: session)
    }
}

/*–ó–∞—Ç–µ–º –º—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π –∏–∑ –Ω–∞—à–∏—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é MovieLoaderFactory, –∏, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –µ–º—É –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –∑–∞–≥—Ä—É–∑—á–∏–∫, –æ–Ω –ª–µ–Ω–∏–≤–æ —Å–æ–∑–¥–∞–µ—Ç –µ–≥–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ–∞–±—Ä–∏–∫–∏. –ö–∞–∫ —ç—Ç–æ:*/

fileprivate class CategoryViewControllerV2: UIViewController {
    private let loaderFactory: MovieLoaderFactory
    private lazy var loader : MoveLoaderV2 = loaderFactory.makeLoader()
    
    
    init(loaderFactory: MovieLoaderFactory) {
        self.loaderFactory = loaderFactory
        super.init(nibName: nil, bundle: nil)
    }
    
    required init?(coder aDecoder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }
}
